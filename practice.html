import React, { useState, useEffect } from 'react';
import { Play, Pause, RotateCcw, Plus, Trash2, Edit2, Save, X, Clock, Calendar, Timer, ChevronUp, ChevronDown, BookOpen, ListChecks, Zap } from 'lucide-react';

const WrestlingPracticeSystem = () => {
  const [mode, setMode] = useState('setup');
  const [setupStep, setSetupStep] = useState('details'); // 'details', 'activities', 'schedule', 'history'
  const [practiceDate, setPracticeDate] = useState('');
  const [startTime, setStartTime] = useState('15:30');
  const [endTime, setEndTime] = useState('17:00');
  const [activities, setActivities] = useState([]);
  const [customActivities, setCustomActivities] = useState([]);
  const [currentActivityIndex, setCurrentActivityIndex] = useState(0);
  const [isRunning, setIsRunning] = useState(false);
  const [elapsedSeconds, setElapsedSeconds] = useState(0);
  const [editingId, setEditingId] = useState(null);
  const [showCustomForm, setShowCustomForm] = useState(false);
  const [customActivity, setCustomActivity] = useState({ 
    title: '', 
    duration: 5, 
    description: '',
    category: 'Drill'
  });
  const [selectedPresets, setSelectedPresets] = useState({});

  // Load custom activities from storage
  useEffect(() => {
    const loadCustomActivities = async () => {
      try {
        const result = await window.storage.get('custom-activities');
        if (result && result.value) {
          setCustomActivities(JSON.parse(result.value));
        }
      } catch (error) {
        console.log('No custom activities found');
      }
    };
    loadCustomActivities();
  }, []);

  // Save custom activities to storage
  const saveCustomActivities = async (newCustomActivities) => {
    try {
      await window.storage.set('custom-activities', JSON.stringify(newCustomActivities));
      setCustomActivities(newCustomActivities);
    } catch (error) {
      console.error('Error saving custom activities:', error);
    }
  };
  
  const presetActivities = [
    { id: 'p1', title: 'Introductions & Warm-up', duration: 5, description: 'Introductions - Favorite Animal', category: 'Warm-up' },
    { id: 'p2', title: 'Warm Up for Success', duration: 5, description: 'Standing Still in own space', category: 'Warm-up' },
    { id: 'p3', title: '1 Legged Hop Competition', duration: 5, description: 'Fun and dynamic warm-up activity', category: 'Warm-up' },
    { id: 'p4', title: 'Shoulder Rolls', duration: 5, description: 'Progress to step out', category: 'Drill' },
    { id: 'p5', title: 'Hip Heists', duration: 5, description: 'Kick Throughs, Hip Heists', category: 'Drill' },
    { id: 'p6', title: 'Build a Base', duration: 5, description: 'Back inch worm, Knee Elbow Push Back Butt Over Heel', category: 'Drill' },
    { id: 'p7', title: 'Bottom Starting Position', duration: 5, description: 'Sit out protect popcorn, Turn Both ways', category: 'Drill' },
    { id: 'p8', title: 'TABLE WRESTLING', duration: 10, description: 'Break table to belly (Instruction and practice)', category: 'Technique' },
    { id: 'p9', title: 'Angle Knee Drop', duration: 5, description: 'Step Drop Shoulder - knee over toe', category: 'Drill' },
    { id: 'p10', title: 'Duck Walk', duration: 10, description: 'Jab step Knee over toe', category: 'Drill' },
    { id: 'p11', title: 'NOODLE SHOTS', duration: 20, description: 'Down Block, peal/wax off and circle, Noodle/Double leg practice', category: 'Technique' },
    { id: 'p12', title: 'Wall Climb Challenge', duration: 10, description: 'Back your feet up the wall', category: 'Challenge' },
    { id: 'p13', title: 'Cool Down & Wrap Up', duration: 5, description: 'Final stretch, water break, and closing remarks', category: 'Cool Down' },
  ];

  const allActivities = [...presetActivities, ...customActivities];

  useEffect(() => {
    let interval;
    if (isRunning && mode === 'live') {
      interval = setInterval(() => {
        setElapsedSeconds(prev => {
          const newTime = prev + 1;
          const currentActivity = activities[currentActivityIndex];
          if (currentActivity && newTime >= currentActivity.duration * 60) {
            if (currentActivityIndex < activities.length - 1) {
              setCurrentActivityIndex(currentActivityIndex + 1);
              return 0;
            } else {
              setIsRunning(false);
              return currentActivity.duration * 60;
            }
          }
          return newTime;
        });
      }, 1000);
    }
    return () => clearInterval(interval);
  }, [isRunning, mode, currentActivityIndex, activities]);

  const togglePresetSelection = (preset) => {
    if (selectedPresets[preset.id]) {
      const newSelected = { ...selectedPresets };
      delete newSelected[preset.id];
      setSelectedPresets(newSelected);
    } else {
      setSelectedPresets({
        ...selectedPresets,
        [preset.id]: { ...preset, duration: preset.duration }
      });
    }
  };

  const updatePresetDuration = (id, duration) => {
    setSelectedPresets({
      ...selectedPresets,
      [id]: { ...selectedPresets[id], duration: parseInt(duration) || 1 }
    });
  };

  const addSelectedActivities = () => {
    const newActivities = Object.values(selectedPresets).map(preset => ({
      ...preset,
      id: Date.now() + Math.random()
    }));
    setActivities([...activities, ...newActivities]);
    setSelectedPresets({});
    setSetupStep('schedule');
  };

  const addCustomActivity = async () => {
    if (customActivity.title.trim()) {
      const newActivity = { 
        ...customActivity, 
        id: 'c' + Date.now()
      };
      const updatedCustomActivities = [...customActivities, newActivity];
      await saveCustomActivities(updatedCustomActivities);
      setCustomActivity({ title: '', duration: 5, description: '', category: 'Drill' });
      setShowCustomForm(false);
    }
  };

  const deleteCustomActivity = async (id) => {
    const updatedCustomActivities = customActivities.filter(a => a.id !== id);
    await saveCustomActivities(updatedCustomActivities);
  };

  const removeActivity = (id) => {
    setActivities(activities.filter(a => a.id !== id));
  };

  const moveActivity = (index, direction) => {
    const newActivities = [...activities];
    const newIndex = direction === 'up' ? index - 1 : index + 1;
    if (newIndex >= 0 && newIndex < activities.length) {
      [newActivities[index], newActivities[newIndex]] = [newActivities[newIndex], newActivities[index]];
      setActivities(newActivities);
    }
  };

  const updateActivity = (id, field, value) => {
    setActivities(activities.map(a => a.id === id ? { ...a, [field]: value } : a));
  };

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  const getCurrentTime = () => {
    return new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
  };

  const [currentTime, setCurrentTime] = useState(getCurrentTime());
  
  useEffect(() => {
    const timer = setInterval(() => {
      setCurrentTime(getCurrentTime());
    }, 1000);
    return () => clearInterval(timer);
  }, []);

  const getTotalDuration = () => {
    return activities.reduce((sum, a) => sum + a.duration, 0);
  };

  const getProgressPercentage = () => {
    if (!activities.length) return 0;
    const totalSeconds = getTotalDuration() * 60;
    const completedSeconds = activities.slice(0, currentActivityIndex).reduce((sum, a) => sum + a.duration * 60, 0) + elapsedSeconds;
    return (completedSeconds / totalSeconds) * 100;
  };

  const getCategoryColor = (category) => {
    const colors = {
      'Warm-up': 'bg-orange-600',
      'Drill': 'bg-blue-600',
      'Technique': 'bg-purple-600',
      'Challenge': 'bg-red-600',
      'Cool Down': 'bg-green-600'
    };
    return colors[category] || 'bg-gray-600';
  };

  // Setup Mode
  if (mode === 'setup') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-900 via-gray-900 to-black text-white">
        {/* Header */}
        <div className="bg-gradient-to-r from-blue-800 to-blue-900 border-b-4 border-yellow-400 py-6 px-8">
          <h1 className="text-5xl font-bold text-center bg-gradient-to-r from-yellow-400 via-white to-blue-400 bg-clip-text text-transparent">
            Wrestling Practice Builder
          </h1>
        </div>

        {/* Step Navigation */}
        <div className="bg-gray-800 border-b-2 border-gray-700">
          <div className="max-w-7xl mx-auto px-8 py-4">
            <div className="flex gap-4">
              <button
                onClick={() => setSetupStep('details')}
                className={`flex-1 py-4 px-6 rounded-lg font-bold text-lg transition-all flex items-center justify-center gap-3 ${
                  setupStep === 'details'
                    ? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white border-2 border-yellow-400'
                    : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                }`}
              >
                <Calendar className="w-6 h-6" />
                <div>
                  <div>Step 1</div>
                  <div className="text-sm">Practice Details</div>
                </div>
              </button>
              <button
                onClick={() => setSetupStep('activities')}
                className={`flex-1 py-4 px-6 rounded-lg font-bold text-lg transition-all flex items-center justify-center gap-3 ${
                  setupStep === 'activities'
                    ? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white border-2 border-yellow-400'
                    : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                }`}
              >
                <BookOpen className="w-6 h-6" />
                <div>
                  <div>Step 2</div>
                  <div className="text-sm">Select Activities</div>
                </div>
              </button>
              <button
                onClick={() => setSetupStep('schedule')}
                className={`flex-1 py-4 px-6 rounded-lg font-bold text-lg transition-all flex items-center justify-center gap-3 ${
                  setupStep === 'schedule'
                    ? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white border-2 border-yellow-400'
                    : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                }`}
              >
                <ListChecks className="w-6 h-6" />
                <div>
                  <div>Step 3</div>
                  <div className="text-sm">Build Schedule</div>
                </div>
              </button>
            </div>
          </div>
        </div>

        {/* Content Area */}
        <div className="max-w-7xl mx-auto p-8">
          {/* Step 1: Practice Details */}
          {setupStep === 'details' && (
            <div className="space-y-6">
              <div className="bg-gradient-to-r from-blue-600 to-blue-800 rounded-lg p-6 border-2 border-yellow-400">
                <h2 className="text-3xl font-bold mb-2 text-yellow-400">Set Your Practice Details</h2>
                <p className="text-white">Enter the date and time for your practice session</p>
              </div>

              <div className="bg-gray-800 rounded-lg p-8 border-2 border-blue-500">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <div>
                    <label className="block text-xl font-bold mb-3 text-blue-400">Practice Date</label>
                    <input
                      type="date"
                      value={practiceDate}
                      onChange={(e) => setPracticeDate(e.target.value)}
                      className="w-full bg-gray-700 border-2 border-gray-600 rounded-lg px-4 py-3 text-white text-lg focus:border-blue-500 focus:outline-none"
                    />
                  </div>
                  <div>
                    <label className="block text-xl font-bold mb-3 text-blue-400">Start Time</label>
                    <input
                      type="time"
                      value={startTime}
                      onChange={(e) => setStartTime(e.target.value)}
                      className="w-full bg-gray-700 border-2 border-gray-600 rounded-lg px-4 py-3 text-white text-lg focus:border-blue-500 focus:outline-none"
                    />
                  </div>
                  <div>
                    <label className="block text-xl font-bold mb-3 text-blue-400">End Time</label>
                    <input
                      type="time"
                      value={endTime}
                      onChange={(e) => setEndTime(e.target.value)}
                      className="w-full bg-gray-700 border-2 border-gray-600 rounded-lg px-4 py-3 text-white text-lg focus:border-blue-500 focus:outline-none"
                    />
                  </div>
                </div>
              </div>

              <button
                onClick={() => setSetupStep('activities')}
                className="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-400 hover:to-yellow-500 text-black rounded-lg py-6 text-2xl font-bold transition-all"
              >
                Next: Select Activities ‚Üí
              </button>
            </div>
          )}

          {/* Step 2: Select Activities */}
          {setupStep === 'activities' && (
            <div className="space-y-6">
              <div className="bg-gradient-to-r from-blue-600 to-blue-800 rounded-lg p-6 border-2 border-yellow-400">
                <h2 className="text-3xl font-bold mb-2 text-yellow-400">Choose Your Activities</h2>
                <p className="text-white">Click activities to select them, then adjust durations and add to your schedule</p>
              </div>

              {/* Create Custom Activity */}
              <div className="bg-gray-800 rounded-lg p-6 border-2 border-blue-500">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-2xl font-bold text-blue-400">Custom Activities</h3>
                  <button
                    onClick={() => setShowCustomForm(!showCustomForm)}
                    className="bg-yellow-500 hover:bg-yellow-600 text-black px-6 py-3 rounded-lg font-bold flex items-center gap-2"
                  >
                    <Plus className="w-5 h-5" />
                    Create New Activity
                  </button>
                </div>

                {showCustomForm && (
                  <div className="bg-gray-700 rounded-lg p-6 mb-4 border-2 border-yellow-400">
                    <h4 className="text-xl font-bold mb-4 text-yellow-400">New Custom Activity</h4>
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-bold mb-2">Activity Title *</label>
                        <input
                          type="text"
                          placeholder="e.g., Partner Takedown Drills"
                          value={customActivity.title}
                          onChange={(e) => setCustomActivity({ ...customActivity, title: e.target.value })}
                          className="w-full bg-gray-800 border-2 border-gray-600 rounded px-4 py-2 text-white focus:border-blue-500 focus:outline-none"
                        />
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-bold mb-2">Duration (minutes) *</label>
                          <input
                            type="number"
                            min="1"
                            value={customActivity.duration}
                            onChange={(e) => setCustomActivity({ ...customActivity, duration: parseInt(e.target.value) || 1 })}
                            className="w-full bg-gray-800 border-2 border-gray-600 rounded px-4 py-2 text-white focus:border-blue-500 focus:outline-none"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-bold mb-2">Category</label>
                          <select
                            value={customActivity.category}
                            onChange={(e) => setCustomActivity({ ...customActivity, category: e.target.value })}
                            className="w-full bg-gray-800 border-2 border-gray-600 rounded px-4 py-2 text-white focus:border-blue-500 focus:outline-none"
                          >
                            <option>Warm-up</option>
                            <option>Drill</option>
                            <option>Technique</option>
                            <option>Challenge</option>
                            <option>Cool Down</option>
                          </select>
                        </div>
                      </div>
                      <div>
                        <label className="block text-sm font-bold mb-2">Description</label>
                        <textarea
                          placeholder="Detailed instructions for this activity..."
                          value={customActivity.description}
                          onChange={(e) => setCustomActivity({ ...customActivity, description: e.target.value })}
                          className="w-full bg-gray-800 border-2 border-gray-600 rounded px-4 py-2 text-white h-24 focus:border-blue-500 focus:outline-none"
                        />
                      </div>
                      <div className="flex gap-3">
                        <button
                          onClick={addCustomActivity}
                          className="flex-1 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-bold"
                        >
                          Save Activity
                        </button>
                        <button
                          onClick={() => {
                            setShowCustomForm(false);
                            setCustomActivity({ title: '', duration: 5, description: '', category: 'Drill' });
                          }}
                          className="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-bold"
                        >
                          Cancel
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {customActivities.length > 0 && (
                  <div>
                    <p className="text-gray-400 mb-3">Your saved custom activities:</p>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                      {customActivities.map((activity) => (
                        <div key={activity.id} className="bg-gray-700 rounded-lg p-3 border border-gray-600 relative">
                          <div className="flex justify-between items-start mb-2">
                            <span className={`${getCategoryColor(activity.category)} text-xs px-2 py-1 rounded text-white font-bold`}>
                              {activity.category}
                            </span>
                            <button
                              onClick={() => deleteCustomActivity(activity.id)}
                              className="text-red-400 hover:text-red-300"
                            >
                              <Trash2 className="w-4 h-4" />
                            </button>
                          </div>
                          <div className="font-bold">{activity.title}</div>
                          <div className="text-sm text-gray-400">{activity.duration} min</div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>

              {/* Activity Library */}
              <div className="bg-gray-800 rounded-lg p-6 border-2 border-blue-500">
                <h3 className="text-2xl font-bold mb-4 text-blue-400">Activity Library</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                  {allActivities.map((preset) => (
                    <button
                      key={preset.id}
                      onClick={() => togglePresetSelection(preset)}
                      className={`rounded-lg p-4 text-left transition-all border-2 ${
                        selectedPresets[preset.id]
                          ? 'bg-gradient-to-r from-yellow-500 to-yellow-600 border-yellow-400 text-black scale-105 shadow-lg'
                          : 'bg-gray-700 border-gray-600 hover:border-blue-400'
                      }`}
                    >
                      <div className="flex justify-between items-start mb-2">
                        <span className={`${getCategoryColor(preset.category)} text-xs px-2 py-1 rounded text-white font-bold`}>
                          {preset.category}
                        </span>
                        {selectedPresets[preset.id] && (
                          <span className="text-2xl">‚úì</span>
                        )}
                      </div>
                      <div className="font-bold">{preset.title}</div>
                      <div className={`text-sm ${selectedPresets[preset.id] ? 'text-gray-900' : 'text-gray-400'}`}>
                        {preset.duration} min
                      </div>
                    </button>
                  ))}
                </div>
              </div>

              {/* Selected Activities */}
              {Object.keys(selectedPresets).length > 0 && (
                <div className="bg-gray-800 rounded-lg p-6 border-2 border-yellow-400">
                  <h3 className="text-2xl font-bold mb-4 text-yellow-400">
                    Selected Activities ({Object.keys(selectedPresets).length})
                  </h3>
                  <p className="text-gray-300 mb-4">Adjust durations before adding to schedule:</p>
                  <div className="space-y-3 mb-6">
                    {Object.values(selectedPresets).map((preset) => (
                      <div key={preset.id} className="flex items-center gap-4 bg-gray-700 rounded-lg p-4">
                        <span className={`${getCategoryColor(preset.category)} text-xs px-3 py-1 rounded text-white font-bold`}>
                          {preset.category}
                        </span>
                        <div className="flex-1 font-bold text-lg">{preset.title}</div>
                        <input
                          type="number"
                          min="1"
                          value={preset.duration}
                          onChange={(e) => updatePresetDuration(preset.id, e.target.value)}
                          className="w-24 bg-gray-900 border-2 border-blue-500 rounded-lg px-3 py-2 text-center text-yellow-400 font-bold text-lg"
                        />
                        <span className="text-gray-400 font-bold">min</span>
                      </div>
                    ))}
                  </div>
                  <button
                    onClick={addSelectedActivities}
                    className="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-400 hover:to-yellow-500 text-black rounded-lg py-4 text-xl font-bold flex items-center justify-center gap-2"
                  >
                    <Plus className="w-6 h-6" />
                    Add {Object.keys(selectedPresets).length} Activities to Schedule
                  </button>
                </div>
              )}

              <div className="flex gap-4">
                <button
                  onClick={() => setSetupStep('details')}
                  className="flex-1 bg-gray-700 hover:bg-gray-600 text-white rounded-lg py-4 text-xl font-bold"
                >
                  ‚Üê Back
                </button>
                <button
                  onClick={() => setSetupStep('schedule')}
                  className="flex-1 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white rounded-lg py-4 text-xl font-bold"
                >
                  Next: Build Schedule ‚Üí
                </button>
              </div>
            </div>
          )}

          {/* Step 3: Build Schedule */}
          {setupStep === 'schedule' && (
            <div className="space-y-6">
              <div className="bg-gradient-to-r from-blue-600 to-blue-800 rounded-lg p-6 border-2 border-yellow-400">
                <div className="flex justify-between items-center">
                  <div>
                    <h2 className="text-3xl font-bold mb-2 text-yellow-400">Your Practice Schedule</h2>
                    <p className="text-white">Arrange activities in order and make final adjustments</p>
                  </div>
                  <div className="text-right">
                    <div className="text-sm text-gray-300">Total Duration</div>
                    <div className="text-4xl font-bold text-yellow-400">{getTotalDuration()} min</div>
                  </div>
                </div>
              </div>

              {activities.length === 0 ? (
                <div className="bg-gray-800 rounded-lg p-12 border-2 border-gray-700 text-center">
                  <p className="text-xl text-gray-400 mb-4">No activities in your schedule yet</p>
                  <button
                    onClick={() => setSetupStep('activities')}
                    className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-lg font-bold text-lg"
                  >
                    Go Back and Select Activities
                  </button>
                </div>
              ) : (
                <>
                  <div className="bg-gray-800 rounded-lg p-6 border-2 border-blue-500">
                    <div className="space-y-3">
                      {activities.map((activity, idx) => (
                        <div key={activity.id} className="bg-gray-700 rounded-lg p-4 flex items-center gap-3 border-2 border-gray-600 hover:border-blue-500 transition-all">
                          <div className="flex flex-col gap-1">
                            <button
                              onClick={() => moveActivity(idx, 'up')}
                              disabled={idx === 0}
                              className="text-blue-400 hover:text-blue-300 disabled:text-gray-600 disabled:cursor-not-allowed"
                            >
                              <ChevronUp className="w-5 h-5" />
                            </button>
                            <button
                              onClick={() => moveActivity(idx, 'down')}
                              disabled={idx === activities.length - 1}
                              className="text-blue-400 hover:text-blue-300 disabled:text-gray-600 disabled:cursor-not-allowed"
                            >
                              <ChevronDown className="w-5 h-5" />
                            </button>
                          </div>
                          <div className="text-2xl font-bold text-yellow-400 w-12 text-center">{idx + 1}</div>
                          <span className={`${getCategoryColor(activity.category)} text-xs px-3 py-1 rounded text-white font-bold`}>
                            {activity.category}
                          </span>
                          {editingId === activity.id ? (
                            <>
                              <input
                                type="text"
                                value={activity.title}
                                onChange={(e) => updateActivity(activity.id, 'title', e.target.value)}
                                className="flex-1 bg-gray-600 border-2 border-gray-500 rounded px-3 py-2 text-white"
                              />
                              <input
                                type="number"
                                value={activity.duration}
                                onChange={(e) => updateActivity(activity.id, 'duration', parseInt(e.target.value) || 1)}
                                className="w-20 bg-gray-600 border-2 border-gray-500 rounded px-3 py-2 text-white"
                              />
                              <button onClick={() => setEditingId(null)} className="text-green-400 hover:text-green-300">
                                <Save className="w-6 h-6" />
                              </button>
                            </>
                          ) : (
                            <>
                              <div className="flex-1">
                                <div className="font-bold text-lg text-white">{activity.title}</div>
                                <div className="text-sm text-gray-400">{activity.description}</div>
                              </div>
                              <div className="text-yellow-400 font-bold text-xl">{activity.duration} min</div>
                              <button onClick={() => setEditingId(activity.id)} className="text-blue-400 hover:text-blue-300">
                                <Edit2 className="w-6 h-6" />
                              </button>
                              <button onClick={() => removeActivity(activity.id)} className="text-red-400 hover:text-red-300">
                                <Trash2 className="w-6 h-6" />
                              </button>
                            </>
                          )}
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={() => setSetupStep('activities')}
                      className="flex-1 bg-gray-700 hover:bg-gray-600 text-white rounded-lg py-4 text-xl font-bold"
                    >
                      ‚Üê Add More Activities
                    </button>
                    <button
                      onClick={() => {
                        setMode('live');
                        setCurrentActivityIndex(0);
                        setElapsedSeconds(0);
                        setIsRunning(false);
                      }}
                      className="flex-1 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-400 hover:to-yellow-500 text-black rounded-lg py-4 text-xl font-bold flex items-center justify-center gap-3"
                    >
                      <Zap className="w-6 h-6" />
                      Start Practice Session
                    </button>
                  </div>
                </>
              )}
            </div>
          )}
        </div>
      </div>
    );
  }

  // Live Mode
  const currentActivity = activities[currentActivityIndex];
  const nextActivity = activities[currentActivityIndex + 1];
  const remainingSeconds = currentActivity ? (currentActivity.duration * 60) - elapsedSeconds : 0;

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-900 via-gray-900 to-black text-white p-4">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="text-center mb-6">
          <h1 className="text-6xl font-bold mb-2 bg-gradient-to-r from-yellow-400 via-blue-400 to-white bg-clip-text text-transparent">
            WRESTLING PRACTICE
          </h1>
          <div className="text-3xl font-bold text-yellow-400 flex items-center justify-center gap-3">
            <Clock className="w-8 h-8" />
            {currentTime}
          </div>
        </div>

        {/* Progress Bar */}
        <div className="bg-gray-800 rounded-full h-8 mb-6 overflow-hidden border-4 border-yellow-400">
          <div
            className="bg-gradient-to-r from-blue-500 via-blue-400 to-yellow-400 h-full transition-all duration-1000"
            style={{ width: `${getProgressPercentage()}%` }}
          />
        </div>

        {/* Main Display */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          {/* Current Activity */}
          <div className="bg-gradient-to-br from-blue-600 to-blue-800 rounded-3xl p-8 border-4 border-yellow-400 shadow-2xl">
            <div className="text-center">
              <div className="text-yellow-400 text-2xl font-bold mb-4">CURRENT ACTIVITY</div>
              <div className="text-6xl font-black mb-4 leading-tight text-white">{currentActivity?.title || 'Complete!'}</div>
              <div className="text-2xl text-gray-200 mb-6">{currentActivity?.description}</div>
              
              {/* Giant Timer */}
              <div className="bg-black rounded-2xl p-8 mb-6 border-2 border-yellow-400">
                <div className="text-9xl font-black text-yellow-400 mb-2">
                  {formatTime(remainingSeconds)}
                </div>
                <div className="text-2xl text-white">TIME REMAINING</div>
              </div>

              <div className="text-3xl font-bold text-white">
                Activity {currentActivityIndex + 1} of {activities.length}
              </div>
            </div>
          </div>

          {/* Next Activity */}
          <div className="bg-gray-800 rounded-3xl p-8 border-4 border-blue-500">
            <div className="text-center">
              <div className="text-blue-400 text-2xl font-bold mb-4">UP NEXT</div>
              {nextActivity ? (
                <>
                  <div className="text-5xl font-black mb-4 text-white">{nextActivity.title}</div>
                  <div className="text-xl text-gray-300 mb-6">{nextActivity.description}</div>
                  <div className="bg-gray-700 rounded-xl p-6 border-2 border-yellow-400">
                    <div className="text-6xl font-black text-yellow-400">{nextActivity.duration}</div>
                    <div className="text-xl text-gray-300">MINUTES</div>
                  </div>
                </>
              ) : (
                <div className="text-4xl font-bold text-yellow-400 py-12">
                  üéâ Last Activity! üéâ
                </div>
              )}
            </div>
          </div>
        </div>

        {/* Controls */}
        <div className="flex justify-center gap-4 mb-6">
          <button
            onClick={() => setIsRunning(!isRunning)}
            className={`${isRunning ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-blue-600 hover:bg-blue-700'} rounded-full p-6 transition-all shadow-lg border-2 border-white`}
          >
            {isRunning ? <Pause className="w-12 h-12" /> : <Play className="w-12 h-12" />}
          </button>
          <button
            onClick={() => {
              setCurrentActivityIndex(0);
              setElapsedSeconds(0);
              setIsRunning(false);
            }}
            className="bg-gray-700 hover:bg-gray-600 rounded-full p-6 transition-all shadow-lg border-2 border-white"
          >
            <RotateCcw className="w-12 h-12" />
          </button>
          <button
            onClick={() => setMode('setup')}
            className="bg-gray-700 hover:bg-gray-600 rounded-full p-6 transition-all shadow-lg border-2 border-white"
          >
            <X className="w-12 h-12" />
          </button>
        </div>

        {/* Full Schedule Timeline */}
        <div className="bg-gray-800 rounded-2xl p-6 border-2 border-blue-500">
          <h3 className="text-2xl font-bold mb-4 text-blue-400">Full Schedule</h3>
          <div className="space-y-2">
            {activities.map((activity, idx) => (
              <div
                key={activity.id}
                className={`rounded-lg p-4 flex items-center gap-4 transition-all ${
                  idx === currentActivityIndex
                    ? 'bg-gradient-to-r from-blue-600 to-blue-700 scale-105 border-2 border-yellow-400'
                    : idx < currentActivityIndex
                    ? 'bg-gray-700 opacity-50'
                    : 'bg-gray-700'
                }`}
              >
                <div className="text-2xl font-bold w-8 text-yellow-400">{idx + 1}</div>
                <span className={`${getCategoryColor(activity.category)} text-xs px-3 py-1 rounded text-white font-bold`}>
                  {activity.category}
                </span>
                <div className="flex-1">
                  <div className="font-bold text-lg text-white">{activity.title}</div>
                  <div className="text-sm text-gray-300">{activity.description}</div>
                </div>
                <div className="text-xl font-bold text-yellow-400">{activity.duration} min</div>
                {idx === currentActivityIndex && (
                  <Timer className="w-6 h-6 text-yellow-400 animate-pulse" />
                )}
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

export default WrestlingPracticeSystem;
